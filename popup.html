<!DOCTYPE html>
<html>
<head>
  <title>Hover Video Control</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      width: 200px;
      text-align: center;
    }
    h1 {
      font-size: 16px;
      margin: 0 0 10px;
      padding: 0;
    }
    button {
      font-size: 14px;
      padding: 10px 20px;
      color: #fff;
      background-color: #0078d7;
      border: none;
      border-radius: 5px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      outline: none;
    }
    button:active {
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }
    button.enabled {
      background-color: #28a745;
    }
    button.disabled {
      background-color: #dc3545;
    }
  </style>
</head>
<body>
  <h1>Hover Video Control</h1>
  <button id="toggleButton">Loading...</button>

  <script>
    const toggleButton = document.getElementById('toggleButton');

    // Load the current state
    chrome.storage.sync.get('hoverControlEnabled', (data) => {
      const isEnabled = data.hoverControlEnabled ?? true; // Default to true if not set
      updateButtonState(isEnabled);
    });

    // Update the state when the button is clicked
    toggleButton.addEventListener('click', () => {
      chrome.storage.sync.get('hoverControlEnabled', (data) => {
        const isEnabled = data.hoverControlEnabled ?? true;
        const newState = !isEnabled;
        chrome.storage.sync.set({ hoverControlEnabled: newState }, () => {
          updateButtonState(newState);
          
          // Reload the current tab to apply changes
          chrome.tabs.query({ active: true, currentWindow: true }, (tabs) => {
            chrome.scripting.executeScript({
              target: { tabId: tabs[0].id },
              func: (enable) => {
                const controlVideoPlayback = (event) => {
                  if (event.type === 'mouseover') {
                    event.target.play();
                  } else if (event.type === 'mouseout') {
                    event.target.pause();
                  }
                };

                const addHoverControl = (video) => {
                  video.addEventListener('mouseover', controlVideoPlayback);
                  video.addEventListener('mouseout', controlVideoPlayback);
                };

                const removeHoverControl = (video) => {
                  video.removeEventListener('mouseover', controlVideoPlayback);
                  video.removeEventListener('mouseout', controlVideoPlayback);
                };

                const videos = document.querySelectorAll('video, #movie_player video, .html5-main-video');
                videos.forEach(video => {
                  if (enable) {
                    addHoverControl(video);
                  } else {
                    removeHoverControl(video);
                  }
                });
              },
              args: [newState]
            });
          });
        });
      });
    });

    function updateButtonState(isEnabled) {
      toggleButton.textContent = isEnabled ? 'Disable Hover Control' : 'Enable Hover Control';
      toggleButton.className = isEnabled ? 'enabled' : 'disabled';
    }
  </script>
</body>
</html>
